<script>
  // Confetti animation (basic version)
  function launchConfetti() {
    for (let i = 0; i < 100; i++) {
      const confetti = document.createElement("div");
      confetti.style.position = "fixed";
      confetti.style.width = "8px";
      confetti.style.height = "8px";
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 60%)`;
      confetti.style.top = "-10px";
      confetti.style.left = Math.random() * 100 + "vw";
      confetti.style.opacity = Math.random();
      confetti.style.borderRadius = "50%";
      confetti.style.zIndex = 1000;
      confetti.style.animation = `fall ${2 + Math.random() * 3}s linear forwards`;
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 5000);
    }
  }

  // Fall animation
  const style = document.createElement('style');
  style.innerHTML = `
    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    #resultModal {
      opacity: 0;
      pointer-events: none;
    }

    #resultModal.show {
      opacity: 1;
      pointer-events: auto;
      transition: opacity 0.5s ease-in-out;
    }
  `;
  document.head.appendChild(style);

  // Parallax effect
  document.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * 10;
    const y = (e.clientY / window.innerHeight - 0.5) * 10;
    document.querySelector(".party-bg").style.backgroundPosition = `${50 + x}% ${50 + y}%`;
  });

  // Load names (excluding Nitin and Balraj)
  window.onload = function () {
    google.script.run.withSuccessHandler(function (names) {
      const dropdown = document.getElementById("nameDropdown");
      names = names.filter(name => name !== "Nitin" && name !== "Balraj");
      names.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        dropdown.appendChild(option);
      });
    }).getNames();
  };

  function showWelcome() {
    const name = document.getElementById("nameDropdown").value;
    const welcome = document.getElementById("welcomeMsg");
    if (name) {
      welcome.style.display = "block";
      welcome.textContent = `ü•≥ Hi ${name}, get ready to party! Tap the button below!`;
    } else {
      welcome.style.display = "none";
    }
  }

  function fetchDetails() {
    const name = document.getElementById("nameDropdown").value;
    const modal = document.getElementById("resultModal");

    if (!name) {
      alert("Please select your name first.");
      return;
    }

    google.script.run.withSuccessHandler(function (data) {
      // Play notification sound
      document.getElementById("notifySound").play();

      // Mobile vibration
      if (navigator.vibrate) navigator.vibrate(100);

      // Launch confetti if not already showing
      if (!modal.classList.contains("show")) {
        launchConfetti();
      }

      // Show result
      modal.innerHTML = `
        <strong>üéâ ${name}</strong><br><br>
        üïµÔ∏è‚Äç‚ôÄÔ∏è Partner in Crime: <strong>${data.partner}</strong><br><br>
        üö® Let the chaos begin!
      `;
      modal.classList.add("show");

      // Scroll to modal
      modal.scrollIntoView({ behavior: "smooth", block: "center" });

      // Hide after 10s
      setTimeout(() => {
        modal.classList.remove("show");
      }, 10000);
    }).getDetails(name);
  }
</script>
